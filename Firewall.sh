#!/bin/sh
#####################################################
#
# Inicializacao do Firewall
#
	echo “Iniciando o Firewall...”
	
IPT="/usr/sbin/iptables"
IP=172.16.105.0

echo “Limpando Regras...”
###########################################################
#
# reset the defaut policies in the filter tables
#	

	$IPT -P INPUT ACCEPT
	$IPT -P FORWARD ACCEPT
	$IPT -P OUTPUT ACCEPT
	
# reset the defaut policies in the nat table.

	$IPT -t nat -P PREROUTING ACCEPT
	$IPT -t nat -P POSTROUTING ACCEPT
	$IPT -t nat -P OUTPUT ACCEPT

# reset the defaut policies in the mangle table

	$IPT -t mangle -P PREROUTING ACCEPT
	$IPT -t mangle -P OUTPUT ACCEPT
	
# flush all the rules in the filter and nat tables

	$IPT -F
	$IPT -t nat -X
	$IPT -t mangle -X
	
###########################################################
#
# Ativar Roteamento e Carregando modulos
#

	echo “Ativando Roteamento...”
	echo 1 > /proc/sys/net/ipv4/ip_forward
	echo 1 > /proc/sys/net/ipv6/conf/all/forwarding
	
	modprobe ip_nat_ftp
	modprobe ip_conntrack_ftp
	modprobe ipt_ipp2p
	
	modprobe ip_conntrack
	modprobe nf_conntrack
	modprobe ip_gre
	
	modprobe nf_nat_pptp
	modprobe nf_conntrack_pptp
	modprobe ip_conntrack_pptp
	
#################################################################
# Regra POSTROUTING
	echo “Criando Regras POSTROUTING ...”
	
	$IPT -t nat -A POSTROUTING -s $IP/24 -o eth0 -j MASQUERADE
	
